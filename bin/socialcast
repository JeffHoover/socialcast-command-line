#!/usr/bin/env ruby

require 'rubygems'
require 'commander/import'
require 'lib/socialcast'
require 'rest_client'

program :version, File.read(File.join(File.dirname(__FILE__), '..', 'VERSION')).strip
program :description, 'command line interface to the socialcast api'

command :share do |c|
  c.syntax = 'socialcast share <message> [options]'
  c.summary = 'share a message'
  c.description = 'post a message into your socialcast stream'
  c.example 'description', 'command example'
  c.option '--user', 'Socialcast account username'
  c.action do |args, options|
    options.default :domain => 'demo.socialcast.local', :user => 'emily@socialcast.com', :password => 'demo'
    message = args.first
    url = ['http://', options.domain, '/api/messages.json'].join
    resource = RestClient::Resource.new url, :user => options.user, :password => options.password, :verify_ssl => OpenSSL::SSL::VERIFY_NONE
    params = {:message => {:body => message}}
    resource.post params do |response|
      say "API response:" if options.trace
      puts response.body if options.trace #FIXME: why doesn't say work here?
    end
    say "Message has been shared"
  end
end

